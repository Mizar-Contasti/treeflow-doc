---
sidebar_position: 1
---

# üé® Widget Web (QWidget)

El Widget Web de TreeFlow, tambi√©n conocido como **QWidget**, es un componente embebible que permite integrar tu chatbot en cualquier sitio web con solo 2 l√≠neas de c√≥digo.

{/* ![QWidget Demo](/img/qwidget-demo-placeholder.svg) */}

## Caracter√≠sticas Principales

### ‚úÖ Integraci√≥n Ultra Simple
Solo 2 l√≠neas de c√≥digo HTML para integrar el widget completo.

### ‚úÖ Web Component Nativo
Construido como Web Component con Shadow DOM para aislamiento de estilos.

### ‚úÖ CDN Global
Disponible v√≠a jsdelivr sin necesidad de descargar archivos.

### ‚úÖ Totalmente Responsive
Se adapta autom√°ticamente a dispositivos m√≥viles y desktop.

### ‚úÖ Personalizable
Configura colores, t√≠tulo, posici√≥n y m√°s mediante atributos HTML.

### ‚úÖ Ligero
Solo 20KB optimizado para carga r√°pida.

## Instalaci√≥n R√°pida

### Paso 1: Agregar el Script

Agrega esta l√≠nea en el `<head>` o antes del cierre de `</body>`:

```html
<script src="https://cdn.jsdelivr.net/gh/Mizar-Contasti/treeflow-web-widget@main/dist/treeflow-widget.js"></script>
```

### Paso 2: Agregar el Widget

Agrega el componente donde quieras que aparezca:

```html
<treeflow-widget 
  endpoint="https://tu-backend.com/message"
  tree-id="tu-tree-id"
  title="Mi Asistente">
</treeflow-widget>
```

¬°Listo! Tu chatbot est√° funcionando.

{/* ![QWidget Setup](/img/qwidget-setup-placeholder.svg) */}

## Ejemplo Completo

```html
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Sitio con TreeFlow</title>
  
  <!-- TreeFlow Widget -->
  <script src="https://cdn.jsdelivr.net/gh/Mizar-Contasti/treeflow-web-widget@main/dist/treeflow-widget.js"></script>
</head>
<body>
  <h1>Bienvenido a mi sitio</h1>
  <p>Contenido de tu p√°gina...</p>
  
  <!-- Widget de TreeFlow -->
  <treeflow-widget 
    endpoint="https://api.mibot.com/message"
    tree-id="6c295eca-5a9f-4588-b1db-1cf5c05f05ee"
    title="Asistente Virtual"
    primary-color="#E4572E"
    position="bottom-right">
  </treeflow-widget>
</body>
</html>
```

## Configuraci√≥n

### Atributos Disponibles

#### `endpoint` (Requerido)
URL del endpoint de tu backend TreeFlow.

```html
<treeflow-widget 
  endpoint="https://api.mibot.com/message">
</treeflow-widget>
```

#### `tree-id` (Requerido)
ID del √°rbol (bot) que quieres usar.

```html
<treeflow-widget 
  tree-id="6c295eca-5a9f-4588-b1db-1cf5c05f05ee">
</treeflow-widget>
```

#### `title` (Opcional)
T√≠tulo que aparece en el header del chat.

```html
<treeflow-widget 
  title="Soporte T√©cnico">
</treeflow-widget>
```

**Por defecto**: "Asistente Virtual"

#### `primary-color` (Opcional)
Color principal del widget (bot√≥n y header).

```html
<treeflow-widget 
  primary-color="#E4572E">
</treeflow-widget>
```

**Por defecto**: "#E4572E" (naranja TreeFlow)

#### `position` (Opcional)
Posici√≥n del bot√≥n flotante.

```html
<treeflow-widget 
  position="bottom-right">
</treeflow-widget>
```

**Opciones**:
- `bottom-right` (por defecto)
- `bottom-left`
- `top-right`
- `top-left`

#### `welcome-message` (Opcional)
Mensaje de bienvenida inicial.

```html
<treeflow-widget 
  welcome-message="¬°Hola! ¬øEn qu√© puedo ayudarte hoy?">
</treeflow-widget>
```

**Por defecto**: "¬°Hola! ¬øEn qu√© puedo ayudarte?"

#### `placeholder` (Opcional)
Placeholder del input de texto.

```html
<treeflow-widget 
  placeholder="Escribe tu mensaje aqu√≠...">
</treeflow-widget>
```

**Por defecto**: "Escribe un mensaje..."

#### `bot-image` (Opcional)
URL de la imagen del avatar del bot.

```html
<treeflow-widget 
  bot-image="https://mi-cdn.com/bot-avatar.png">
</treeflow-widget>
```

#### `z-index` (Opcional)
Controla el apilamiento CSS del widget.

**Por defecto**: "10000"

#### `file-upload` (Opcional)
Habilita o deshabilita la subida de archivos.

**Por defecto**: "true"

#### `microphone` (Opcional)
Habilita o deshabilita la entrada de voz (STT).

**Por defecto**: "true"

#### `debug` (Opcional)
Activa el modo de depuraci√≥n para ver logs en consola.

**Por defecto**: "false"

#### `start-event` (Opcional)
Evento que se env√≠a autom√°ticamente al abrir el widget por primera vez.

```html
<treeflow-widget start-event="WELCOME_EVENT"></treeflow-widget>
```

#### `enable-maximize` (Opcional)
Permite al usuario maximizar el widget a pantalla completa.

**Por defecto**: "false"

### Ejemplo con Todas las Opciones

```html
<treeflow-widget 
  endpoint="https://api.mibot.com/message"
  tree-id="6c295eca-5a9f-4588-b1db-1cf5c05f05ee"
  title="Soporte 24/7"
  primary-color="#2563EB"
  position="bottom-left"
  welcome-message="¬°Bienvenido! Estoy aqu√≠ para ayudarte."
  placeholder="¬øC√≥mo puedo ayudarte?">
</treeflow-widget>
```

## Referencia de Bloques JSON

El widget renderiza diferentes tipos de contenido basado en la respuesta del backend. Aqu√≠ est√°n los formatos soportados:

### Texto Simple
```json
{
  "type": "text",
  "text": "Hola, ¬øc√≥mo est√°s?"
}
```

### Tarjeta (Card)
```json
{
  "type": "card",
  "title": "T√≠tulo de la Tarjeta",
  "subtitle": "Subt√≠tulo opcional",
  "text": "Descripci√≥n detallada...",
  "image": "https://ejemplo.com/imagen.jpg",
  "actions": [
    { "label": "Ver m√°s", "payload": "VER_MAS" }
  ]
}
```

### Carrusel
```json
{
  "type": "carousel",
  "items": [
    {
      "type": "card",
      "title": "Opci√≥n 1",
      "image": "https://...",
      "actions": [...]
    },
    {
      "type": "card",
      "title": "Opci√≥n 2",
      "image": "https://...",
      "actions": [...]
    }
  ]
}
```

### Imagen
```json
{
  "type": "image",
  "url": "https://ejemplo.com/foto.jpg",
  "title": "Texto alternativo"
}
```

### Video
Soporta YouTube, Vimeo y archivos directos (mp4).
```json
{
  "type": "video",
  "url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ"
}
```

### Audio
```json
{
  "type": "audio",
  "url": "https://ejemplo.com/audio.mp3",
  "title": "Podcast Episodio 1"
}
```

### Archivo
```json
{
  "type": "file",
  "url": "https://ejemplo.com/documento.pdf",
  "title": "Manual de Usuario.pdf",
  "size": "2.5 MB"
}
```

### Ubicaci√≥n
Puede mostrar una ubicaci√≥n o solicitarla.
```json
{
  "type": "location",
  "latitude": 40.416775,
  "longitude": -3.703790,
  "title": "Nuestra Oficina",
  "address": "Calle Principal 123"
}
```

### Respuestas R√°pidas (Chips)
```json
{
  "type": "quick_replies",
  "items": [
    { "label": "S√≠", "payload": "YES" },
    { "label": "No", "payload": "NO" },
    { "label": "Quiz√°s", "payload": "MAYBE", "icon": "help" }
  ]
}
```

## API del Backend

El widget se comunica con tu backend mediante el endpoint `/message`.

### Request

```json
POST /message
Content-Type: application/json

{
  "type": "text",
  "value": "Hola, necesito ayuda",
  "tree_id": "6c295eca-5a9f-4588-b1db-1cf5c05f05ee",
  "session_id": "uuid-generado-automaticamente"
}
```

### Response

```json
{
  "response": "¬°Hola! Con gusto te ayudo. ¬øQu√© necesitas?",
  "suggestions": ["Ver productos", "Hablar con soporte", "Rastrear pedido"],
  "session_id": "uuid-generado-automaticamente"
}
```

### Campos de Response

#### `response` (Requerido)
Texto de respuesta del bot.

#### `suggestions` (Opcional)
Array de sugerencias que se muestran como chips interactivos.

#### `session_id` (Opcional)
ID de sesi√≥n para mantener el contexto de la conversaci√≥n.

## Caracter√≠sticas Avanzadas

### Componentes Ricos y Multimedia

El widget soporta una variedad de componentes interactivos para enriquecer la conversaci√≥n:

#### üé† Carrusel Interactivo
- **Drag-to-Scroll**: Navega entre tarjetas arrastrando horizontalmente (t√°ctil y mouse).
- **Snap-to-Card**: El carrusel se alinea autom√°ticamente a la tarjeta m√°s cercana al soltar.
- **Contenido**: Cada tarjeta puede incluir imagen, t√≠tulo, descripci√≥n y botones.

#### üéµ Audio Mejorado
- **Visualizaci√≥n**: Muestra una onda de audio (waveform) visual.
- **Controles**: Reproducci√≥n/Pausa y duraci√≥n del audio.
- **Dise√±o**: Integrado visualmente con el tema del chat.

#### üìÅ Archivos Adjuntos
- **Descarga Directa**: Bot√≥n de descarga que fuerza el guardado del archivo.
- **Metadatos**: Muestra icono de tipo de archivo, nombre y tama√±o.

#### üí¨ Respuestas R√°pidas (Chips)
- **Estilo Moderno**: Las opciones se muestran como "chips" o p√≠ldoras horizontales.
- **Iconos e Im√°genes**: Soporte para iconos y peque√±as im√°genes dentro de los chips.

### Sugerencias Interactivas

El widget muestra sugerencias como chips clicables:

```json
{
  "response": "¬øEn qu√© puedo ayudarte?",
  "suggestions": [
    "Ver productos",
    "Hablar con soporte",
    "Rastrear mi pedido"
  ]
}
```

{/* ![QWidget Suggestions](/img/qwidget-suggestions-placeholder.svg) */}

### Indicador de Escritura

Muestra autom√°ticamente "Escribiendo..." mientras espera respuesta del backend.

### Sesiones Persistentes

El widget genera y mantiene un `session_id` √∫nico por usuario para mantener el contexto.

### Scroll Autom√°tico

Se desplaza autom√°ticamente al √∫ltimo mensaje.

### Responsive Design

Se adapta autom√°ticamente a:
- Desktop (ventana completa)
- Tablet (ventana mediana)
- M√≥vil (pantalla completa)

## Control Program√°tico

### Abrir/Cerrar el Widget

```javascript
// Obtener referencia al widget
const widget = document.querySelector('treeflow-widget');

// Abrir el chat
widget.open();

// Cerrar el chat
widget.close();

// Toggle (abrir/cerrar)
widget.toggle();
```

### Enviar Mensaje Program√°ticamente

```javascript
const widget = document.querySelector('treeflow-widget');

// Enviar mensaje
widget.sendMessage('Hola desde JavaScript');
```

### Escuchar Eventos

```javascript
const widget = document.querySelector('treeflow-widget');

// Evento cuando se abre el chat
widget.addEventListener('open', () => {
  console.log('Chat abierto');
});

// Evento cuando se cierra el chat
widget.addEventListener('close', () => {
  console.log('Chat cerrado');
});

// Evento cuando se env√≠a un mensaje
widget.addEventListener('message-sent', (event) => {
  console.log('Mensaje enviado:', event.detail.message);
});

// Evento cuando se recibe una respuesta
widget.addEventListener('message-received', (event) => {
  console.log('Respuesta recibida:', event.detail.response);
});
```

## Personalizaci√≥n Avanzada

### CSS Custom Properties

Puedes personalizar a√∫n m√°s el widget con CSS:

```css
treeflow-widget {
  --primary-color: #E4572E;
  --text-color: #333333;
  --background-color: #FFFFFF;
  --user-message-bg: #E4572E;
  --bot-message-bg: #F3F4F6;
  --border-radius: 12px;
  --font-family: 'Inter', sans-serif;
}
```

### Ejemplo de Personalizaci√≥n

```html
<style>
  treeflow-widget {
    --primary-color: #2563EB;
    --user-message-bg: #2563EB;
    --bot-message-bg: #EFF6FF;
    --border-radius: 16px;
    --font-family: 'Poppins', sans-serif;
  }
</style>

<treeflow-widget 
  endpoint="https://api.mibot.com/message"
  tree-id="6c295eca-5a9f-4588-b1db-1cf5c05f05ee">
</treeflow-widget>
```

## Integraci√≥n con Frameworks

### React

```jsx
import { useEffect, useRef } from 'react';

function App() {
  const widgetRef = useRef(null);
  
  useEffect(() => {
    // Cargar el script
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/gh/Mizar-Contasti/treeflow-web-widget@main/dist/treeflow-widget.js';
    document.head.appendChild(script);
    
    return () => {
      document.head.removeChild(script);
    };
  }, []);
  
  return (
    <div>
      <h1>Mi App React</h1>
      <treeflow-widget 
        ref={widgetRef}
        endpoint="https://api.mibot.com/message"
        tree-id="6c295eca-5a9f-4588-b1db-1cf5c05f05ee"
        title="Asistente">
      </treeflow-widget>
    </div>
  );
}
```

### Vue.js

```vue
<template>
  <div>
    <h1>Mi App Vue</h1>
    <treeflow-widget 
      ref="widget"
      endpoint="https://api.mibot.com/message"
      tree-id="6c295eca-5a9f-4588-b1db-1cf5c05f05ee"
      title="Asistente">
    </treeflow-widget>
  </div>
</template>

<script>
export default {
  mounted() {
    // Cargar el script
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/gh/Mizar-Contasti/treeflow-web-widget@main/dist/treeflow-widget.js';
    document.head.appendChild(script);
  }
}
</script>
```

### Angular

```typescript
import { Component, OnInit } from '@angular/core';

@Component({
  selector: 'app-root',
  template: `
    <h1>Mi App Angular</h1>
    <treeflow-widget 
      endpoint="https://api.mibot.com/message"
      tree-id="6c295eca-5a9f-4588-b1db-1cf5c05f05ee"
      title="Asistente">
    </treeflow-widget>
  `
})
export class AppComponent implements OnInit {
  ngOnInit() {
    // Cargar el script
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/gh/Mizar-Contasti/treeflow-web-widget@main/dist/treeflow-widget.js';
    document.head.appendChild(script);
  }
}
```

## Troubleshooting

### Problema: Widget no aparece

**Soluci√≥n**: Verifica que el script est√© cargado correctamente.

```javascript
// Verificar en consola
console.log(customElements.get('treeflow-widget'));
// Debe retornar la clase del componente
```

### Problema: Error de CORS

**Soluci√≥n**: Configura CORS en tu backend.

```python
# FastAPI
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # En producci√≥n, especifica dominios
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### Problema: Sesiones no persisten

**Soluci√≥n**: Verifica que tu backend retorne el mismo `session_id`.

```json
{
  "response": "Respuesta del bot",
  "session_id": "mismo-id-recibido"
}
```

### Problema: Estilos no se aplican

**Soluci√≥n**: Usa CSS Custom Properties dentro del Shadow DOM.

```css
/* ‚ùå No funciona */
.chat-message {
  color: red;
}

/* ‚úÖ Funciona */
treeflow-widget {
  --text-color: red;
}
```

## Mejores Pr√°cticas

### ‚úÖ Usa HTTPS

Siempre usa HTTPS para tu endpoint en producci√≥n.

```html
<!-- ‚ùå Evita -->
<treeflow-widget endpoint="http://api.mibot.com/message">

<!-- ‚úÖ Mejor -->
<treeflow-widget endpoint="https://api.mibot.com/message">
```

### ‚úÖ Maneja Errores

Implementa manejo de errores en tu backend.

```python
@app.post("/message")
async def handle_message(request: MessageRequest):
    try:
        response = process_message(request)
        return response
    except Exception as e:
        return {
            "response": "Lo siento, ocurri√≥ un error. Por favor intenta de nuevo.",
            "error": str(e)
        }
```

### ‚úÖ Optimiza Respuestas

Mant√©n las respuestas concisas y claras.

```json
{
  "response": "Tu pedido #12345 est√° en camino. Llegar√° ma√±ana entre 9am-5pm.",
  "suggestions": ["Rastrear pedido", "Cambiar direcci√≥n", "Hablar con soporte"]
}
```

### ‚úÖ Usa Sugerencias

Gu√≠a al usuario con sugerencias relevantes.

```json
{
  "response": "¬øEn qu√© m√°s puedo ayudarte?",
  "suggestions": [
    "Ver productos",
    "Estado de mi pedido",
    "Pol√≠tica de devoluciones"
  ]
}
```

## Recursos Adicionales

- [Repositorio en GitHub](https://github.com/Mizar-Contasti/treeflow-web-widget)
- [Setup Web](/docs/Injertos/Web/setup)
- [Personalizaci√≥n](/docs/Injertos/Web/personalizacion)
- [Eventos](/docs/Injertos/Web/eventos)

---

:::tip Versi√≥n
Esta documentaci√≥n es para TreeFlow v0.4 con QWidget mejorado.
:::
